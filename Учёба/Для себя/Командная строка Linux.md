# Командная строка Linux
#book #prog #linux | [[book]] [[prog]] [[linux]]
- - -
## Content
1) Командная оболочка
2) Навигация
3) Файловая система
4) Операции с файлами и каталогами
5) Работа с командами
6) Перенаправление и поиск
- - -
&nbsp;


## 1. Командная оболочка

>[!quote]- bash
>Командная оболочка над ОС, созданная  GNU. Сокращение от Bourne Again Shell, то есть улучшенная версия изначальной оболочки shell, созданная Боурном

>[!xxx]- shell prompt
>Приглашение к вводу. Если оно заканчивается не долларом, а решеткой, значит мы под суперпользователем

> [!xxx]- Буфер обмена и фокус ввода
> Система ГУИ в линуксе позволяет пользоваться буфером гораздо удобнее. Для этого достаточно выделить текст, а потом вставлять его колесиком мыши. При этом фокус ввода будет там, где курсор, и для этого даже необязательно дополнительно нажимать на окно, куда хочется ввести текст

> [!info]- date
> Показывает текущую дату
> 
> ```r
> volnogaz@volnogaz-MS-7B89:~$ date
> 
> Вт 07 июн 2022 08:20:51 MSK
> ``` 

> [!info]- cal
> Календарь
> 
>      
> ```r
> volnogaz@volnogaz-MS-7B89:~$ df -a
>
>Вс Пн Вт Ср Чт Пт Сб  
>           1  2  3  4  
>  5  6  7  8  9 10 11  
> 12 13 14 15 16 17 18  
> 19 20 21 22 23 24 25  
> 26 27 28 29 30 
>  ```  

> [!info]- df
> Объем свободного пространства на диске
> 
> ```r
> volnogaz@volnogaz-MS-7B89:~$ df
>
> Filesystem     1K-blocks     Used Available Use% Mounted on
> udev            16374716        0  16374716   0% /dev
> tmpfs            3282048     2176   3279872   1% /run
> /dev/nvme0n1p5 320449408 22323248 281778564   8% /
> tmpfs           16410232     5596  16404636   1% /dev/shm
> tmpfs               5120        4      5116   1% /run/lock
> tmpfs           16410232        0  16410232   0% /sys/fs/cgroup
> /dev/loop0         56960    56960         0 100% /snap/core18/2344
> /dev/loop2         30080    30080         0 100% /snap/pyright/329
> /dev/loop1         56960    56960         0 100% /snap/core18/2409
> ```
> - `-h` делает все human readable
> ```r
> volnogaz@volnogaz-MS-7B89:~$ df -h
> 
> Filesystem      Size  Used Avail Use% Mounted on
> udev             16G     0   16G   0% /dev
>tmpfs           3,2G  2,2M  3,2G   1% /run
>/dev/nvme0n1p5  306G   22G  269G   8% /
>tmpfs            16G  129M   16G   1% /dev/shm
>tmpfs           5,0M  4,0K  5,0M   1% /run/lock
>tmpfs            16G     0   16G   0% /sys/fs/cgroup
>/dev/loop0       56M   56M     0 100% /snap/core18/2344
>/dev/loop2       30M   30M     0 100% /snap/pyright/329
>/dev/loop1       56M   56M     0 100% /snap/core18/2409
> ```
>
> - `-a` показать сводку обо всех файловых системах
> ```r
> volnogaz@volnogaz-MS-7B89:~$ df -a
> 
> Filesystem     1K-blocks     Used Available Use% Mounted on
> sysfs                  0        0         0    - /sys
> proc                   0        0         0    - /proc
> udev            16374716        0  16374716   0% /dev
> devpts                 0        0         0    - /dev/pts
> tmpfs            3282048     2176   3279872   1% /run
> /dev/nvme0n1p5 320449408 22329624 281772188   8% /
> securityfs             0        0         0    - /sys/kernel/security
> tmpfs           16410232   142392  16267840   1% /dev/shm
> tmpfs               5120        4      5116   1% /run/lock
> tmpfs           16410232        0  16410232   0% /sys/fs/cgroup
> cgroup2                0        0         0    - /sys/fs/cgroup/unified
> cgroup                 0        0         0    - /sys/fs/cgroup/systemd
> pstore                 0        0         0    - /sys/fs/pstore
> efivarfs               0        0         0    - /sys/firmware/efi/efivars
> none                   0        0         0    - /sys/fs/bpf
> cgroup                 0        0         0    - /sys/fs/cgroup/net_cls,net_prio
> cgroup                 0        0         0    - /sys/fs/cgroup/misc
> cgroup                 0        0         0    - /sys/fs/cgroup/devices
> cgroup                 0        0         0    - /sys/fs/cgroup/perf_event
> 
> ```
> 
> - `-x` не показывать некоторые ФС. Например, `-x devtmpfs -x tmpfs` не будет показывать временные файловые системы
> 
> - `-t` наоборот, покажет только указанную ФС.
> ```r
> volnogaz@volnogaz-MS-7B89:~$ df -t tmpfs
> Filesystem     1K-blocks   Used Available Use% Mounted on
> tmpfs            3282048   2176   3279872   1% /run
> tmpfs           16410232 175172  16235060   2% /dev/shm
> tmpfs               5120      4      5116   1% /run/lock
> tmpfs           16410232      0  16410232   0% /sys/fs/cgroup
> tmpfs            3282044   1556   3280488   1% /run/user/1000
> ```

> [!xxx]- Консоль за кулисами
> В ОС постоянно открыта куча виртуальных терминалов на фоне. Чтобы зайти в них, используются `ctrl+alt+F1` - `ctrl+alt+F6` , навигация по ним `alt + F1` - `alt + F6`. Вернуться к рабочему столу через `alt + F7`

- - -
&nbsp;
## 2. Навигация
> [!info]- ls
> Список файлов в директории. Можно выводить несколько директорий сразу, перечисляя их аргументами
> - `-l` выводит файлы в более подробном (long) формате:
> `Права доступа, число жестких ссылок, владелец, группа, размер в байтах, дата изменения, название`
> 
> ```r
> volnogaz@volnogaz-MS-7B89:~/Programms$ ls -l
> total 76
> -rwxrwxr-x  1 volnogaz volnogaz 16808 июн  5 21:26 a.out
> drwxrwxr-x 18 volnogaz volnogaz  4096 июн  7 07:17 BKUsem4
> -rw-rw-r--  1 volnogaz volnogaz  6493 мая 20 17:11 btree.cpp
> drwxrwxr-x  5 volnogaz volnogaz  4096 июн  5 22:18 Contest1
> -rw-rw-r--  1 volnogaz volnogaz   753 июн  5 21:31 contest_div.cpp
> -rw-rw-r--  1 volnogaz volnogaz   339 июн  5 21:24 contest_div.py
> -rw-rw-r--  1 volnogaz volnogaz    25 июн  5 23:05 German.py
> drwxrwxr-x  5 volnogaz volnogaz  4096 мар 20 09:58 Ozon_Python_Clone_Test
> drwxrwxr-x  6 volnogaz volnogaz  4096 мар  8 02:03 Ozon_Python_HW1_env
> -rw-rw-r--  1 volnogaz volnogaz   116 мар  8 02:12 requirements.lock.txt
> -rw-rw-r--  1 volnogaz volnogaz   125 мая 24 03:04 test.cpp
> -rw-rw-r--  1 volnogaz volnogaz  5952 мая 24 03:03 test.txt
> drwxrwxr-x  2 volnogaz volnogaz  4096 мар 30 14:21 tmp
> ```
>  - `-t` отсортирует вывод по времени
>
>  - `-S` отсортировать результаты по размеру
>  
>  - `-d` показывать информацию о папке, а не о содержимом
>  
>  - `-i` показывать в первом столбце номер индексного узла, на который ссылается ссылка
> ```r
> volnogaz@volnogaz-MS-7B89:~/Programms$ ls -il
> total 80
> 19142603 -rwxrwxr-x  1 volnogaz volnogaz 16808 июн  5 21:26 a.out
> 19138023 drwxrwxr-x 18 volnogaz volnogaz  4096 июн  7 07:17 BKUsem4
> 19151167 -rw-rw-r--  1 volnogaz volnogaz  6493 мая 20 17:11 btree.cpp
> 19660895 drwxrwxr-x  3 volnogaz volnogaz  4096 июн  7 17:41 Codeforces
>  4198150 drwxrwxr-x  5 volnogaz volnogaz  4096 июн  5 22:18 Contest1
> 19152028 -rw-rw-r--  1 volnogaz volnogaz   753 июн  5 21:31 contest_div.cpp
> 19151432 -rw-rw-r--  1 volnogaz volnogaz   339 июн  5 21:24 contest_div.pyя готов на нее 
> ```

> [!info]- pwd
> Путь текущей директории

> [!info]- cd
> Сменить директорию

> [!info]- file
> Краткое описание файла и его формата
> ```r
> volnogaz@volnogaz-MS-7B89:~/Programms$ file test.cpp
> test.cpp: C++ source, ASCII text
> ```

> [!info]- less
> Прочитать содержимое. Улучшенная версия читалки "more" с прокруткой
> - `q` завеощить
> - `G` конец файла
> - `g` начало файла
> - `h` справка
> - `/блаблабла` поиск по файлу
> - `n` следующее вхождение

- - -
&nbsp;
## 3. Файловая система
### Каталоги системы Linux
| Каталог       | Описание                                                                     |
| ------------- | ---------------------------------------------------------------------------- |
| `/`           | Корневой каталог                                                             |
| `/bin`        | Бинарные файлы программ и утилит, необходимых для запуска ОС                 |
| `/boot`       | Ядро Linux, образ RAM-диска и загрузчик                                      |
| `/dev`        | Список всех девайсов и устройств в виде файлов                               |
| `/etc`        | Конфиги, сценарии командной оболочки                                         |
| `/home`       | Домашний каталог кжадого пользователя                                        |
| `/lib`        | Файлы разделяемых библиотек. Что-то типа DDL в Windows                       |
| `/lost+found` | Нужен на случай поломки и восстановления                                     |
| `/media`      | Содержит точки монтирования съемных носителей (USB, CD-ROM)                  |
| `/opt`        | Опциональное, необязательное ПО                                              |
| `/proc`       | Виртуальная папка. Все файлы в ней -- "глаза" в мир ядра линукса             |
| `/root`       | Домашней каталог root пользователя                                           |
| `/sbin`       | Системные бинарники                                                          |
| `/tmp`        | Временное хранилище                                                          |
| `/usr`        | Все программы и файлы поддержки для обычных пользователей                    |
| `/var`        | Каталог с часто изменяемыми данными: базами данных, буферными файлами и т.д. |
- - -
&nbsp;

## 4. Операции с файлами и каталогами

### Маски (шаблоны)
`*` - любой набор символов
`?` - любой один символ
`[abcdef]` - любой один символ из заданных
`[!abcdef]` - любой один символ кроме выбранных
`[[:class:]]` - любой один символ из данного класса

Например:
`[[:alnum:]]` - буква-цифра
`[[:alpha:]]` - буква
`[[:digit:]]` - цифра
`[[:lower:]]` - маленькая буква
`[[:upper:]]` - большая буква

>[!xxx]- Шаблон для скрытых файлов
>Если просто использовать `.*`, он покажет все файлы, начинающиеся с точки, но при этом вместе с `.` и `..`
>
>Для корректного отображения только скрытых файлов, необходимо использовать `.[!.]?*` - то есть файл, начинающийся с точки, продолжающийся чем-то кроме точки и имеющий после этого любое количество символов


> [!info]- mkdir
> Создаёт директории, перечисленные далее

> [!info]- cp
> Скопирует файлы
> 1) `cp item1 item2` копирует item1 в item2
> 2) `cp item1 item2 item3 folder` копирует предметы в одну папку
> 
> - `-a` (архивирование) скопировать еще и атрибуты (иначе проставятся по умолчанию)
> 
> - `-i` (интерактивно) запрашивать разрешение на перезапись (**иначе перезачтет не спрашивая**)
> 
> - `-r` (рекурскивно) рекурсивно копировать папки и их содержимое. Обязательно ставить если двигаешь папки
> 
> - `-v` (вербально) выводить сообщения в процессе

> [!info]- mw
> Почти то же самое что и `cp`, но не оставляет изначальный файл и не использует `-r`

> [!info]- rm
> Удаление файлов и папок
> 
> - `-i` (интекрактивно) спрашивать при удалении существующих файлов
> 
> - `-r` (рекурсивно) Обязательно применять, чтобы при удалении папок удалялось еще и содержимое
>
> - `-f` (насильно) игнорировать отсутствие файлов и запрос подтверждений от `-i`
> 
> - `v` (вербально) печать информацию

&nbsp;
### Ссылки

>[!quote]- Жесткая ссылка
> Основной способ обратиться к файлу. Каждый файл изначально имеет одну жесткую ссылку, определяющую его имя. Создавая жесткую ссылку, мы создаём дополнительную запись в файловой системе
> 
> Минусы:
> - Жесткая ссылка не может указывать на файл вне своей файловой системы
> - Жесткая ссылка не может указывать на папку
> 
> При удалении жесткой ссылки файл не удаляется. Он удалится только когда удалятся все жесткие ссылки на него

>[!quote]- Символическая ссылка
>Что-то наподобие ярлыков из Windows. Вспомогательный файл, содержащий текстовый указатель на файл или папку. Если делать какие-то операции с ссылкой, она будет делать их с файлом. Однако если удалить ее, то файл не удалится. Если же файл удалится до удаления ссылки на него, такая ссылка станет **битой**

> [!info]- ln
> Создаёт жесткую или символическую ссылку на файл
> -  `ln elem link` -- создаёт жесткую ссылку
> 
> - `ln -s elem link` -- создаёт символическую ссылку

> [!xxx]- Символическая ссылка в проводнике
> Перетягивай файл или папку и удерживай `shift + ctrl`

- - -
&nbsp;

## 5. Работа с командами
Чем может быть команда?
1) **Программой**, написанной на каком-то языке программирования
2) **Встроенной в bash командой**, такой как `ls`
3) **Написанной на bash командой**
4) **Алиасом**

> [!info]- history
> Выводит всю историю (по умолчанию последние 500 команд)

> [!info]- type
> Узнаёт тип команды
> 
> `type command`

> [!info]- which
> Показывает бинарник, который исполняет команду
> 
> `which command`

> [!info]- Справка
> - `help command` - встроенная справка от bash
> 
> - `command --help` - стандартный флаг, поддерживаемый многими командами
> 
> - `man command` - официальная документация команды
> 
> - `whatis command`- очень краткое описание команды
> ```r
> volnogaz@volnogaz-MS-7B89:~/Sandbox$ whatis mv
> mv (1)               - move (rename) files
> ```

> [!xxx]- Несколько команд разом
> Раздели их точкой с запятой!
> 
> `cmd1; cmd2; cmdn`

> [!info]-  alias
> Чтобы обозначить последовательность комманд своим псевдонимом,
> для начала убедись, что команда свободна, а затем используй
> 
> `alias name='commands'`
> 
> Например:
> 
> `alias new_command='cd ..; ls -hli; rm -vi -r *'`
> 
> Чтобы удалить алиас, используем
> 
> `unalias alias_name`

> [!warning]-  Алиасы недолговечны
> Все алиасы, созданные просто в терминале, удаляются при выключении пк

> [!xxx]-  Список алиасов
> Если написать команду `alias` без аргументов, она выведет все алиасы в текущем окружении 

- - -
&nbsp;

## 6. Перенаправление и поиск

Основными файловыми дескрипторами служат 
1) `stdin (0)`
2) `stdout (1)`
3) `stderr (2)` 

Чтобы перенаправить дескрипторы с клавиатуры и экрана на те или иные команды, используем
```r
cmd1 > cmd2
```

> [!xxx]- stderr
> По умолчанию перенаправляется только вывод в `stdout`. Поэтому все ошибки и предупреждения будет выходить на экран.
> 
> Чтобы перенаправить `stderr` или любой другой файловый дескриптор по его номеру, пишем этот номер перед стрелкой:
> 
> `ls -ahli 2> errors.txt `

> [!xxx]- Пустой файл
> Перенаправление открывает файл на запись, то есть очищает его. Поэтому для очищения файла можно воспользоваться лайфхаком и передать в него пустую команду:
> 
> `> file_with_content.txt`
> 
> Чтобы открыть файл на добавление и не удалять его содержимое, используем две стрелки:
> 
> `cmd1 >> cmd2`


> [!xxx]- Дескриптор в дескриптор
> Можно перенаправить все выводы в один файл, направив туда `stdout`, а `stderr` направить туда же, куда и `stdout`. Для этого пишем следующее:
> 
> `ls -ahli > output.txt 2>&1`'
> 
> В современных версиях bash можно объединить оба дескриптора более простым синтаксисом:
> 
> `ls -ahli &> output.txt`

> [!xxx]- Замьютить вывод
> Если надо заглушить какой либо вывод, его надо передать в слжебный файл `/dev/null`

> [!info]- cat
> Выводит содержимое файла в `stdout`
> 
> - `-n` добавляет номера строк
> 
> Также может конкатенировать несколько файлов и направлять уже их общее содержимое. Например, если большие данные разделены на несколько файлов `file1, file2, ..., file100`, то их можно объединить командой
> 
> `cat file* > all_files.txt`  ъ
> 
> Если запустить команду без аргументов, то она будет читать числа из `stdin`, то есть по умолчанию с клавиатуры

> [!xxx]- Быстрый текстовый файл
> Чтобы создать текстовый файл, необязательно использовать `touch` и `vim`. Достаточно написать
> 
> `cat > new_file.txt`
> 
> и ввести с клавиатуры его содержимое. Для конца ввода нажимаем `ctrl+D`

Стрелка влево `<` наоборот перенаправляет стандартный ввод. То есть команда:
```
cat < text_file.txt
```

Заменяет стандартный ввод для `cat` на содержимое файла `text_file.txt`

&nbsp;

### Конвейеры и поиск

Чтобы связать стандартный вывод одной команды со стандартным вводом другой, используется символ `|`. С помощью него можно соединять несколько команд в цепочку

> [!xxx]- Чистый вывод команды 
> Чтобы не засорять рабочее пространство, можно направлять результат работы команды в `less`:
> 
> `command | less`

Перед тем как вывести работу команды, иногда бывает полезно пройтись по ней некоторым **фильтром**. Например, чтобы вывод команды был отсортирован по алфавиту, можем написать следующее:

`command | sort | less`

> [!info]- sort
> Сортирует в алфавитном порядке введенные строки

> [!info]- uniq
> Выводит только уникальные строки
> 
> - `-d` вывести только дубликаты

> [!info]- wc
> Выводит количество строк, слов и байтов в файле. Без аргументов считывает данные с `stdin`
> 
> - `-l (lines)` вывести только строки
> 
> - `-w (words)` вывести только слова
> 
> - `-c ` вывести только байты

> [!info]- grep
> Ищет среди файлов совпадение по шаблону и пишет все строки с совпадением
> 
> `grep template [file1 file2 ...]`
> 
> - `-i` игнорировать регистр
> 
> - `-v` вывести строки где совпадение **не** найдено

> [!info]- head/tail
> Выводит первые/последние 10 строк файла
> 
> - `-n` вывести другое количество строк
> `head -n 7 file.txt` выведет 7 строк
> 
> - `-f` следить за файлом в реальном времени, пока не нажмем `ctrl+C`

> [!info]- tee
> Читает данные из `stdin` и копирует их в `stdout` (чтобы передать их дальше по конвейеру) и в какие-то файлы. То есть можем сохранять промежуточный результат работы
> `some cmd | tee buf.txt | grep zip` 

- - -
&nbsp;


## 7. Мир глазами оболочки
Каждый раз при нажатии `Enter` bash выполняет несколько операций. Например, аргумент `*` это не просто "любой файл". В стадии препроцессинга команды `bash` просто подставляет в команду список всех файлов текущей директории.
Поэтому, например команда `echo *` не выведет * . Вместо этого выведется список всех файлов.

> [!info]- cat
> Выводит любой свой аргумент
>[!xxx]- Шаблон для скрытых файлов
>Если просто использовать `.*`, он покажет все файлы, начинающиеся с точки, но при этом вместе с `.` и `..`
>
>Для корректного отображения только скрытых файлов, необходимо использовать `.[!.]?*` - то есть файл, начинающийся с точки, продолжающийся чем-то кроме точки и имеющий после этого любое количество символов

>[!xxx]- Подстановка арифметических выражений
>Чтобы вставить на препроцессинге в команду арифметическое выражение, необходимо написать `$((выражение))`. То есть команда `echo $((3**2 - 4))` выдаст 5.
>
>Поддерживаемые операции перекликаются с синтаксисом питона:
>- `+` плюс
>- `-` минус
>- `*` умножить
>- `/` делить нацело
>- `%` остаток
>- `**` степень

>[!xxx]- Комбинаторный перебор
>Можно перечислить несколько строк, часть которых перечисляется из определенного количества вариантов. Для этого используем синтаксис `начало-{вар1, вар2, вар3}-конец` - эта конструкция сгенерирует 3 строки. Также можно использовать `начало-{вар1..варN}-конец`

>[!xxx]- Подстановка параметров
>Некоторые постоянные переменные хранятся в окружении. Список переменных можно получить командой `printenv | less`. Чтобы подставить значение переменной, нужно использовать  синтаксис `$переменная`
>
>Примеры некоторых переменных в моем окружении:
>- `SHELL = bin/bash`
>- `USER = volnogaz`
>- `HOME = /home/volnogaz`

>[!xxx]- Подстановка команд
>Можно инлайн вставить результат работы одной команды, например, в качестве аргумента для другой. Для этого всю команду надо использовать синтаксис `$(команда)`


&nbsp;

### Экранирование
Экранирование - это способ подавить замену переменной на препроцессинге.

Первый тип экранирования - двойные кавычки. Всё, что находится в двойных кавычках теряет свой служебный смысл и воспринимается оболочкой как текст (кроме $, `\`, `).
То есть по прежнему выполняется подстановка аргументов, путей и команд, но будут игнорироваться разбиение на слова, подстановка путей, тильды и фигурных скобок.

Таким способом можно, например, обработать файл с пробелом в названии

Второй тип экранирования это одиночные кавычки. Они просто подавляют абсолютно все служебные операции препроцессора и воспринимают написанное как чистый текст

Чтобы экранировать ровно один символ, перед ним можно поставить обратный слэш и не писать кавычки

>[!xxx]- Управляющие последовательности
>Обратный слэш нужен также для указания управляющего кода. Вот некоторые из них
> - `\a` - Звонок (подать звуковой сигнал)
> - `\b` - Backspace
> - `\n` - newline
> - `\t` - Табуляция
- - -
&nbsp;

## 8. Работа с клавиатурой
Для операций редактирования командной строки bash использует библиотеку *"Readline"*. Туда входят сдвиги курсором клавишами влево-вправо, история, но есть и другие

&nbsp;
### Команды Readline
| Клавиши  | Действие                                 |
| -------- | ---------------------------------------- |
| `ctrl+A` | Переместить курсор в начало строки       |
| `ctrl+E` | Переместить курсор в конец строки        |
| `alt+F`  | На слово вперед                          |
| `alt+B`  | На слово назад                           |
| `ctrl+L` | Очистить экран (`clear`)                 |
| `ctrl+K` | Удаляет символы до конца строки          |
| `ctrl+U` | Удаляет символы до начала строки         |

&nbsp;

### Команды поиска по истории
| Клавиша    | Действие                                            |
| ---------- | --------------------------------------------------- |
| `ctrl+R`   | Начать поиск по истории                             |
| `ctrl+J`   | Скопировать команду из поиска по истории            |
| `!!`       | Повторить последнюю команду                         |
| `!число`   | Повторить команду с указанным номером               |
| `!строка`  | Повторить последнюю команду, начинавшуюся со строки |
| `!?строка` | Повторить последнюю команду, содержавшую строку     |


## 9. Привелегии
> [!info]- id
> Показывает идентификаторы пользователя
> ```r
> volnogaz@volnogaz-MS-7B89:~$ id
> 
> uid=1000(volnogaz) gid=1000(volnogaz) groups=1000(volnogaz),
> 4(adm),24(cdrom),27(sudo),30(dip),4(plugdev),
> 120(lpadmin),132(lxd),133(sambashare)
> ```
> - `-u` выводить только uid
> - `-g` выводить только gid
> - `-G` выводить только groups

> [!info]- chmod
> Изменяет права доступа к файлу/каталогу
> `chmod [опции] ГруппаДействиеПрава файл`
> 
> Группы:
> - `u` владелец
> - `g` группа
> - `o` остальные
> 
> Действие:
> - `-` отнять
> - `+` дать
> - `=` оставить только эти
> 
> Права:
> - `r` чтение
> - `w` запись
> - `x` исполнение
> 
> Ну или просто трёмя восьмеричными цифрами 😸

### Изменение идентичности

